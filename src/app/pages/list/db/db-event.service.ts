import { HttpClient } from '@angular/common/http';
import { Injectable } from '@angular/core';

interface Events {
  List: Function;
}

@Injectable({
  providedIn: 'root'
})
export class DbEventService {
  public Event: { [key: string]: Events } = {};

  constructor(public http: HttpClient) {
    this.register('bilibili', {
      List: async () => {
        const res = { "code": 0, "msg": "", "data": [{ "id": "5647710", "comic_id": 28649, "title": "在无神的世界进行信仰传播", "status": 2, "last_ord": 19, "ord_count": 42, "hcover": "http://i0.hdslb.com/bfs/manga-static/b72a72bfbe6e5f52a6165f4bd3869fb7486deb3d.jpg", "scover": "http://i0.hdslb.com/bfs/manga-static/c9172ba47feb8a25f86501b85e3a046412ed9d71.jpg", "vcover": "http://i0.hdslb.com/bfs/manga-static/f7087237522dd879f1248b4a3a4764edbf548a2c.jpg", "publish_time": "2020.10.28", "last_ep_publish_time": "2023-07-12 12:01:44", "last_ep_id": 654648, "last_ep_short_title": "19", "latest_ep_short_title": "41", "allow_wait_free": false, "type": 0, "rookie_expire_time": "", "free_type": 0, "latest_ep_id": 1225430, "has_read_latest_ep": false, "updated_count": 0, "is_limit_free": false, "latest_read_time": "2023-07-29 01:58:25" }, { "id": "5632586", "comic_id": 30304, "title": "OVERLORD  不死者之王", "status": 2, "last_ord": 1, "ord_count": 73, "hcover": "https://i0.hdslb.com/bfs/manga-static/e32dd717f9803a2bd7f6a0ea14100b073944def9.jpg", "scover": "https://i0.hdslb.com/bfs/manga-static/4ad258879804f513818a4f47606b5c3643726795.jpg", "vcover": "https://i0.hdslb.com/bfs/manga-static/5b38adfd4595060df9ac5a727c70f606c21134ae.jpg", "publish_time": "", "last_ep_publish_time": "2022-12-07 17:49:07", "last_ep_id": 603335, "last_ep_short_title": "1", "latest_ep_short_title": "66", "allow_wait_free": false, "type": 0, "rookie_expire_time": "", "free_type": 0, "latest_ep_id": 1017033, "has_read_latest_ep": false, "updated_count": 0, "is_limit_free": false, "latest_read_time": "2023-07-18 13:22:49" }, { "id": "5632585", "comic_id": 32020, "title": "别当哥哥了！", "status": 2, "last_ord": 5, "ord_count": 86, "hcover": "https://i0.hdslb.com/bfs/manga-static/910165b7369b4d2b00e02ea56b4c7df4ce683480.jpg", "scover": "https://i0.hdslb.com/bfs/manga-static/e889fcbeb1e5d7f8c756b06867a41c520f9f9578.jpg", "vcover": "https://i0.hdslb.com/bfs/manga-static/f9ac6034d2fda54ada8e335be5018745acd8bfa7.jpg", "publish_time": "", "last_ep_publish_time": "2023-07-27 12:02:12", "last_ep_id": 806141, "last_ep_short_title": "5", "latest_ep_short_title": "77", "allow_wait_free": false, "type": 0, "rookie_expire_time": "", "free_type": 0, "latest_ep_id": 1237860, "has_read_latest_ep": false, "updated_count": 0, "is_limit_free": false, "latest_read_time": "2023-06-28 02:06:47" }, { "id": "5629879", "comic_id": 32569, "title": "赡养上帝", "status": 3, "last_ord": 2, "ord_count": 8, "hcover": "https://i0.hdslb.com/bfs/manga-static/59bbecb8f2b4eb3968a8f45880d1345a1c9cf281.png", "scover": "https://i0.hdslb.com/bfs/manga-static/c47b635252714ced37f2b670f508bf07c037c787.jpg", "vcover": "https://i0.hdslb.com/bfs/manga-static/83bf5ff4f5c7a1651307b4b3f507937b92c6695e.jpg", "publish_time": "", "last_ep_publish_time": "2023-01-19 12:00:48", "last_ep_id": 914373, "last_ep_short_title": "第2话", "latest_ep_short_title": "第8话", "allow_wait_free": false, "type": 0, "rookie_expire_time": "", "free_type": 0, "latest_ep_id": 1052449, "has_read_latest_ep": false, "updated_count": 0, "is_limit_free": false, "latest_read_time": "2023-04-28 21:21:39" }, { "id": "5544030", "comic_id": 30977, "title": "前辈，有穿内裤的吗？", "status": 3, "last_ord": 21, "ord_count": 21, "hcover": "https://i0.hdslb.com/bfs/manga-static/fbcd28c2bc04f25adc35b5979f95e06c93085a60.jpg", "scover": "https://i0.hdslb.com/bfs/manga-static/a28c673a0eeda14aa109d3bbde1549e16f71a5ed.jpg", "vcover": "https://i0.hdslb.com/bfs/manga-static/cc4df2498504aa02f9f2434dbd2f21c5257db632.jpg", "publish_time": "", "last_ep_publish_time": "2021-12-03 12:00:00", "last_ep_id": 660658, "last_ep_short_title": "最终话", "latest_ep_short_title": "最终话", "allow_wait_free": false, "type": 0, "rookie_expire_time": "", "free_type": 0, "latest_ep_id": 660658, "has_read_latest_ep": false, "updated_count": 0, "is_limit_free": false, "latest_read_time": "2023-07-26 13:22:17" }, { "id": "5307045", "comic_id": 32346, "title": "再见绘梨", "status": 3, "last_ord": 1, "ord_count": 2, "hcover": "https://i0.hdslb.com/bfs/manga-static/99fe7326e1f0ebfc111d0f4e7e9b3249034160a4.jpg", "scover": "https://i0.hdslb.com/bfs/manga-static/7a59cd85ac445a119435f3c5872547c05e88713a.jpg", "vcover": "https://i0.hdslb.com/bfs/manga-static/bf7f0e7ac746db9ee6afc483b461da9b77842a23.jpg", "publish_time": "2022.08.20", "last_ep_publish_time": "2022-08-20 12:00:04", "last_ep_id": 848387, "last_ep_short_title": "短篇", "latest_ep_short_title": "短篇", "allow_wait_free": false, "type": 0, "rookie_expire_time": "", "free_type": 0, "latest_ep_id": 848387, "has_read_latest_ep": false, "updated_count": 0, "is_limit_free": false, "latest_read_time": "2023-05-02 19:55:28" }, { "id": "5248031", "comic_id": 28376, "title": "Chainsaw Man", "status": 2, "last_ord": 137, "ord_count": 137, "hcover": "https://i0.hdslb.com/bfs/manga-static/223785ec4b2da303349c6785763fdceade11e2bd.jpg", "scover": "https://i0.hdslb.com/bfs/manga-static/15b08abcaf216d2816db618dd12a0bd497ce5212.jpg", "vcover": "https://i0.hdslb.com/bfs/manga-static/fef4e807325510365fb87389a4e2c1695360249a.jpg", "publish_time": "2020.11.02", "last_ep_publish_time": "2023-07-25 23:01:44", "last_ep_id": 1236981, "last_ep_short_title": "S2-40", "latest_ep_short_title": "S2-40", "allow_wait_free": false, "type": 0, "rookie_expire_time": "", "free_type": 0, "latest_ep_id": 1236981, "has_read_latest_ep": false, "updated_count": 0, "is_limit_free": false, "latest_read_time": "2023-07-27 14:18:37" }, { "id": "4820968", "comic_id": 29583, "title": "异世界舅舅", "status": 2, "last_ord": 43, "ord_count": 44, "hcover": "https://i0.hdslb.com/bfs/manga-static/27da00fda5a67a4c5a9a867211a1f342056b6c8c.jpg", "scover": "https://i0.hdslb.com/bfs/manga-static/0e0bdb21d9c7d571977bec8503d70f43ee651b82.jpg", "vcover": "https://i0.hdslb.com/bfs/manga-static/244ca421e08c23fa3bf251b00ddcdbf7768c561d.jpg", "publish_time": "2021.03.26", "last_ep_publish_time": "2022-10-20 00:00:22", "last_ep_id": 949274, "last_ep_short_title": "43", "latest_ep_short_title": "43", "allow_wait_free": false, "type": 0, "rookie_expire_time": "", "free_type": 0, "latest_ep_id": 949274, "has_read_latest_ep": false, "updated_count": 0, "is_limit_free": false, "latest_read_time": "2023-06-05 23:40:22" }, { "id": "4701779", "comic_id": 30005, "title": "别哭啊魔王酱", "status": 3, "last_ord": 3, "ord_count": 49, "hcover": "https://i0.hdslb.com/bfs/manga-static/ea12e2ed9e1fb3a5e57d4049908763e0348866f4.jpg", "scover": "https://i0.hdslb.com/bfs/manga-static/a63cb05ca2df22a85311da7d87199998e4a163ba.jpg", "vcover": "https://i0.hdslb.com/bfs/manga-static/e323433eb1741de59fa2d93e15bb4cb103395fef.jpg", "publish_time": "2021.06.19", "last_ep_publish_time": "2021-07-07 00:00:00", "last_ep_id": 589774, "last_ep_short_title": "3", "latest_ep_short_title": "最终话", "allow_wait_free": false, "type": 0, "rookie_expire_time": "", "free_type": 0, "latest_ep_id": 595077, "has_read_latest_ep": false, "updated_count": 0, "is_limit_free": false, "latest_read_time": "2023-03-31 00:11:53" }, { "id": "4700280", "comic_id": 28386, "title": "更衣人偶坠入爱河", "status": 2, "last_ord": 73, "ord_count": 95, "hcover": "https://i0.hdslb.com/bfs/manga-static/a500c5f458653333675adce459192f1829845061.jpg", "scover": "http://i0.hdslb.com/bfs/manga-static/6eb7fa866c304f96b746a581739bcad122d1e13b.jpg", "vcover": "https://i0.hdslb.com/bfs/manga-static/7c73f79310ef5d7ed958c4c0ef789edfb839508b.jpg", "publish_time": "2020.11.11", "last_ep_publish_time": "2023-07-21 18:31:23", "last_ep_id": 713370, "last_ep_short_title": "73", "latest_ep_short_title": "94", "allow_wait_free": false, "type": 0, "rookie_expire_time": "", "free_type": 0, "latest_ep_id": 1233613, "has_read_latest_ep": false, "updated_count": 0, "is_limit_free": false, "latest_read_time": "2023-04-28 21:21:59" }, { "id": "4618057", "comic_id": 27250, "title": "我立于百万生命之上", "status": 2, "last_ord": 1, "ord_count": 87, "hcover": "https://i0.hdslb.com/bfs/manga-static/f52d82044ff083e905694e0509bf379838c1c072.jpg", "scover": "http://i0.hdslb.com/bfs/manga-static/4726b1e8137a8e0eabf4cb455c63d024bbbd75cd.jpg", "vcover": "https://i0.hdslb.com/bfs/manga-static/f10131606349dc4932bc10a068b3adc8d5ba113e.jpg", "publish_time": "", "last_ep_publish_time": "2023-07-07 12:01:46", "last_ep_id": 370869, "last_ep_short_title": "1", "latest_ep_short_title": "85", "allow_wait_free": false, "type": 0, "rookie_expire_time": "", "free_type": 0, "latest_ep_id": 1220730, "has_read_latest_ep": false, "updated_count": 0, "is_limit_free": false, "latest_read_time": "2023-06-04 01:17:10" }, { "id": "4435483", "comic_id": 28520, "title": "新世纪福音战士", "status": 3, "last_ord": 1, "ord_count": 97, "hcover": "http://i0.hdslb.com/bfs/manga-static/8d60a13fdfa830c53f6ce9f773531753e1aa5c82.jpg", "scover": "http://i0.hdslb.com/bfs/manga-static/b76f9af08aa500489a87c449f209e6d97431e1ed.jpg", "vcover": "http://i0.hdslb.com/bfs/manga-static/9351bbb71a9726af47e3abce3ce8f3cecbed5b08.jpg", "publish_time": "2020.10.03", "last_ep_publish_time": "2020-10-03 00:00:00", "last_ep_id": 489790, "last_ep_short_title": "1", "latest_ep_short_title": "EXTRA", "allow_wait_free": false, "type": 0, "rookie_expire_time": "", "free_type": 0, "latest_ep_id": 491726, "has_read_latest_ep": false, "updated_count": 0, "is_limit_free": false, "latest_read_time": "2023-07-27 12:21:29" }, { "id": "4401222", "comic_id": 31332, "title": "蓦然回首", "status": 3, "last_ord": 0.5, "ord_count": 2, "hcover": "https://i0.hdslb.com/bfs/manga-static/ad170a9df8d8c4bf9638e787348c38eb01972f98.jpg", "scover": "https://i0.hdslb.com/bfs/manga-static/e5fcb0f3d6f079e2c513a6be5ddd60ea9b447b7a.jpg", "vcover": "https://i0.hdslb.com/bfs/manga-static/05502ff9b6d4c093281ff2341dc389981e611837.jpg", "publish_time": "2022.02.11", "last_ep_publish_time": "2022-02-11 12:00:00", "last_ep_id": 693972, "last_ep_short_title": "试阅", "latest_ep_short_title": "1", "allow_wait_free": false, "type": 0, "rookie_expire_time": "", "free_type": 0, "latest_ep_id": 693975, "has_read_latest_ep": false, "updated_count": 0, "is_limit_free": false, "latest_read_time": "2023-07-20 13:23:14" }, { "id": "4294977", "comic_id": 31008, "title": "夏目新的结婚", "status": 2, "last_ord": 8, "ord_count": 68, "hcover": "https://i0.hdslb.com/bfs/manga-static/569ee40945c6754bdaedb0673b6def8edd62ebf6.jpg", "scover": "https://i0.hdslb.com/bfs/manga-static/2cc7156aa03043bd607dd13d3d9118ce1c1ce78b.jpg", "vcover": "https://i0.hdslb.com/bfs/manga-static/fc6239acf17dfd012086d21db84ff4410169b348.jpg", "publish_time": "", "last_ep_publish_time": "2022-11-24 17:44:56", "last_ep_id": 662733, "last_ep_short_title": "8", "latest_ep_short_title": "68", "allow_wait_free": false, "type": 0, "rookie_expire_time": "", "free_type": 0, "latest_ep_id": 997577, "has_read_latest_ep": false, "updated_count": 0, "is_limit_free": false, "latest_read_time": "2023-02-21 22:13:07" }, { "id": "4276044", "comic_id": 29481, "title": "鬼刀", "status": 2, "last_ord": 41, "ord_count": 43, "hcover": "https://i0.hdslb.com/bfs/manga-static/eec2bf5e7138667dda2962c66404bb595b4fcb49.jpg", "scover": "https://i0.hdslb.com/bfs/manga-static/3a697954dd5117702112dfdb53a8738a56c85cc9.jpg", "vcover": "https://i0.hdslb.com/bfs/manga-static/916baf8bbaa9a0f8e3c6fa335da0e945703eac97.jpg", "publish_time": "2021.03.05", "last_ep_publish_time": "2023-03-07 11:10:11", "last_ep_id": 1102392, "last_ep_short_title": "41", "latest_ep_short_title": "41", "allow_wait_free": false, "type": 0, "rookie_expire_time": "", "free_type": 0, "latest_ep_id": 1102392, "has_read_latest_ep": false, "updated_count": 0, "is_limit_free": false, "latest_read_time": "2023-04-28 21:16:41" }] }
        const list = res.data.map(x => {
          // const cover=
          const httpUrlToHttps = (str: string) => {
            const url = new URL(str);
            if (url.protocol == "http:") {
              return `https://${url.host}${url.pathname}`
            } else {
              return str
            }
          }
          return { id: x.id, cover: httpUrlToHttps(x.vcover), title: x.title, subTitle: `看到 ${x.last_ep_short_title} 话 / 共 ${x.latest_ep_short_title} 话` }
        });
        return list
      }
    })
  }

  register(key: string, events: Events) {
    if (this.Event[key]) this.Event[key] = { ...this.Event[key], ...events };
    else this.Event[key] = events;
  }

}
